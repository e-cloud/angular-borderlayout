!function(e,t){"function"==typeof define&&define.amd?define(["angular","underscore"],t):"object"==typeof module&&module.exports?module.exports=t(require("angular"),require("underscore")):t(angular,e._)}(this,function(e,t){var n=e.module("fa.directive.borderLayout",[]),i=!1;return n.factory("paneManager",function(){return{panes:{},get:function(e){return this.panes[e]},set:function(e,t){return this.panes[e]=t},remove:function(e){return delete this.panes[e]}}}),n.factory("Region",function(){function t(e,t,n,i,o,a){this.width=null!=e?e:0,this.height=null!=t?t:0,this.top=null!=n?n:0,this.right=null!=i?i:0,this.bottom=null!=o?o:0,this.left=null!=a?a:0}return t.prototype.clone=function(){return new t(this.width,this.height,this.top,this.right,this.bottom,this.left)},t.prototype.calculateSize=function(t,n){var i,o;null==n&&(n=0);var a=this.getSize(t),r=this.getAvailableSize(t);if(e.isNumber(n))return n>=1?Math.round(n):n>=0?Math.round(n*a):0;if(n=n.replace(/\s+/gm,""),(o=n.split("-")).length>1)return this.calculateSize(t,o.shift())-this.calculateSize(t,o.join("+"));if((o=n.split("+")).length>1)return this.calculateSize(t,o.shift())+this.calculateSize(t,o.join("+"));if(i=n.match(/^(\d+)(?:px)?$/))return parseInt(i[1],10);if(i=n.match(/^(\d+(?:\.\d+)?)&$/))return Math.round(r*parseFloat(i[1])/100);if(i=n.match(/^(\d+(?:\.\d+)?)%$/))return Math.round(a*parseFloat(i[1])/100);throw new Error("Unsupported size: "+n)},t.prototype.consume=function(e,t){var n;switch(null==t&&(t=0),e){case"north":n={top:""+this.top+"px",right:""+this.right+"px",bottom:"auto",left:""+this.left+"px",height:""+t+"px",width:"auto"},this.top+=t;break;case"east":n={top:""+this.top+"px",right:""+this.right+"px",bottom:""+this.bottom+"px",left:"auto",width:""+t+"px",height:"auto"},this.right+=t;break;case"south":n={top:"auto",right:""+this.right+"px",bottom:""+this.bottom+"px",left:""+this.left+"px",height:""+t+"px",width:"auto"},this.bottom+=t;break;case"west":n={top:""+this.top+"px",right:"auto",bottom:""+this.bottom+"px",left:""+this.left+"px",width:""+t+"px",height:"auto"},this.left+=t}return 0===t&&(n.display="none"),n},t.prototype.getInnerRegion=function(){return new t(this.width-this.right-this.left,this.height-this.top-this.bottom)},t.prototype.getSize=function(e){switch(e){case"vertical":return this.height;case"horizontal":return this.width}},t.prototype.getAvailableSize=function(e){switch(e){case"vertical":return this.height-this.top-this.bottom;case"horizontal":return this.width-this.right-this.left}},t.prototype.toString=function(){return"{"+this.top+", "+this.right+", "+this.bottom+", "+this.left+"}, {"+this.width+", "+this.height+"}"},t}),n.directive("faPane",["$window","$rootScope","paneManager","Region",function(t,n,o,a){var r=function(e){switch(e){case"north":case"south":return"vertical";case"east":case"west":return"horizontal"}},s=function(e,t){var n={top:0,right:0,bottom:0,left:0};if(t)switch(e){case"north":n.bottom="auto",n.height=""+t+"px";break;case"east":n.left="auto",n.width=""+t+"px";break;case"south":n.top="auto",n.height=""+t+"px";break;case"west":n.right="auto",n.width=""+t+"px"}return n},l=function(e,t,n){switch(e){case"north":return{height:t.calculateSize("vertical",n)+"px",right:0,left:0,bottom:0};case"south":return{height:t.calculateSize("vertical",n)+"px",right:0,left:0,top:0};case"east":return{width:t.calculateSize("horizontal",n)+"px",top:0,bottom:0,left:0};case"west":return{width:t.calculateSize("horizontal",n)+"px",top:0,bottom:0,right:0}}},h=function(){var e=0,t=function(){return e++};return t.peek=function(){return e},t}();return{restrict:"A",replace:!0,require:"faPane",priority:1,transclude:"element",scope:{anchor:"@paneAnchor",paneId:"@faPane",size:"@paneSize",min:"@paneMin",max:"@paneMax",handle:"@paneHandle",closed:"=paneClosed",order:"@paneOrder",noToggle:"@paneNoToggle"},template:'<div class="fa-pane {{$pane.id?\'pane-\'+$pane.id:\'pane-null-id\'}}"> <div class="fa-pane-overlay"></div> <div class="fa-pane-handle" fa-pane-resizer> <div ng-if="!$pane.noToggle" class="fa-pane-toggle" ng-click="$pane.toggle()"></div> </div> </div>',controllerAs:"$pane",controller:function(){e.extend(this,{children:[],closed:!1,noToggle:!1,max:Number.MAX_VALUE,min:0,$scheduleReflow:function(){var e=this;e.parent?e.parent.$scheduleReflow():e.$reflowScheduled||(e.$reflowScheduled=!0,n.$evalAsync(function(){e.$reflowScheduled&&e.reflow(),e.$reflowScheduled=!1}))},$onStartResize:function(){this.$parent?this.parent.$containerEl.addClass("fa-pane-resizing"):this.$containerEl.addClass("fa-pane-resizing")},$onStopResize:function(){this.$parent?this.parent.$containerEl.removeClass("fa-pane-resizing"):this.$containerEl.removeClass("fa-pane-resizing")},getOptions:function(){return{anchor:this.anchor,targetSize:this.targetSize,size:this.size,min:this.min,max:this.max,order:this.order||0,handle:{open:this.handleSizeOpen||0,closed:this.handleSizeClosed||0},noToggle:!!this.noToggle,closed:this.closed}},setOptions:function(e){null==e&&(e={}),null!=e.anchor&&this.setAnchor(e.anchor),null!=e.size&&this.setTargetSize(e.size),null!=e.min&&this.setMinSize(e.min),null!=e.max&&this.setMaxSize(e.max),null!=e.handle&&this.setHandleSize(e.handle),null!=e.order&&this.setOrder(e.order),null!=e.noToggle&&this.setNoToggle(e.noToggle),null!=e.closed&&this.toggle(!e.closed)},setAnchor:function(e){this.anchor=e,this.$scheduleReflow()},setTargetSize:function(e){this.targetSize=e,this.$scheduleReflow()},setMinSize:function(e){this.min=e,this.$scheduleReflow()},setMaxSize:function(e){this.max=e,this.$scheduleReflow()},setOrder:function(e){this.order=e,this.$scheduleReflow()},setNoToggle:function(e){this.noToggle=e,this.$scheduleReflow()},setHandleSize:function(e){(null!=e?e.open:void 0)||(null!=e?e.closed:void 0)?(this.handleSizeOpen=parseInt(e.open,10)||0,this.handleSizeClosed=parseInt(e.closed,10)||0):this.handleSizeOpen=this.handleSizeClosed=parseInt(e,10),this.$scheduleReflow()},addChild:function(e){e.parent=this,this.children.push(e),this.children.length&&this.$containerEl.addClass("fa-pane-parent"),this.$scheduleReflow()},getOrientation:function(){return r(this.anchor)},onHandleDown:function(){this.$containerEl.addClass("active")},onHandleUp:function(){this.$containerEl.removeClass("active"),this.$scheduleReflow()},removeChild:function(e){var t;0>(t=this.children.indexOf(e))||this.children.splice(t,1),this.children.length||this.$containerEl.removeClass("fa-pane-parent"),this.$scheduleReflow()},reflow:function(e){var t=this,i=t.$containerEl[0].offsetWidth,o=t.$containerEl[0].offsetHeight;e||(e=new a(i,o));var h=t.anchor;if("north"===h||"east"===h||"south"===h||"west"===h){t.$containerEl.removeClass("fa-pane-orientation-vertical"),t.$containerEl.removeClass("fa-pane-orientation-horizontal");var c=r(t.anchor);t.$containerEl.addClass("fa-pane-orientation-"+c);var u=e.calculateSize(c,!t.closed&&t.handleSizeOpen||t.handleSizeClosed),d=u;t.closed||(d=e.calculateSize(c,!t.closed&&t.targetSize||u),d=Math.min(d,e.calculateSize(c,t.max)),d=Math.max(d,e.calculateSize(c,t.min)),d=Math.min(d,e.getAvailableSize(c)),d=Math.max(d,u)),this.size=d;var p=e.consume(t.anchor,d),f=s(t.anchor,d-u),g=l(t.anchor,e,u);t.$containerEl.attr("style","").css(p),t.$overlayEl.attr("style","").css(f),t.$handleEl.attr("style","").css(g),t.$scrollerEl.attr("style","").css(f)}else t.$containerEl.css({top:e.top+"px",right:e.right+"px",bottom:e.bottom+"px",left:e.left+"px",width:"auto",height:"auto"});t.$region=e.clone(),t.reflowChildren(e.getInnerRegion()),n.$broadcast("fa-pane-resize",t)},reflowChildren:function(e){var t=this;e||(e=t.$region),t.children.sort(function(e,t){return e.order-t.order});for(var n=[],i=0;i<t.children.length;i++){var o=t.children[i];n.push(o.reflow(e))}return n},resize:function(e){var t=this;null==e&&(e=t.targetSize),t.targetSize=e,t.parent.reflowChildren(t.parent.$region.getInnerRegion()),e!==t.size?t.$containerEl.addClass("fa-pane-constrained"):t.$containerEl.removeClass("fa-pane-constrained")},toggle:function(e){var t=this;if(i)return i=!1,t;null==e&&(e=!!t.closed),t.closed=!e;var n=function(){t.parent?t.parent.$scheduleReflow():t.$scheduleReflow()};t.closed?t.$containerEl.addClass("fa-pane-closed"):t.$containerEl.removeClass("fa-pane-closed"),n()}})},compile:function(e,n,i){var a=h();return function(e,n,r,s){var l=e.$parent.$new();l.$pane=e.$pane=s;var h=l.$new();null==s.order&&(s.order=a),s.id=r.faPane,s.$isolateScope=e,s.$directiveScope=l,s.$transcludeScope=h,i(h,function(i){i.addClass("fa-pane-scroller"),n.append(i),s.$containerEl=n,s.$overlayEl=n.children().eq(0),s.$handleEl=n.children().eq(1),s.$scrollerEl=n.children().eq(2),e.$watch("anchor",function(e){s.setAnchor(e)}),e.$watch("size",function(e){s.setTargetSize(e)}),e.$watch("closed",function(e){s.toggle(!e)}),e.$watch("min",function(e){s.setMinSize(null!=e?e:0)}),e.$watch("max",function(e){s.setMaxSize(null!=e?e:Number.MAX_VALUE)}),e.$watch("order",function(e){s.setOrder(e)}),e.$watch("noToggle",function(e){s.setNoToggle(!!e)}),e.$watch("paneId",function(e,t){t&&o.remove(t),o.set(e,s),s.id=e}),e.$watch("handle",function(e){s.setHandleSize(e)}),e.$watch(r.paneHandleObj,function(e){e&&s.setHandleSize(e)},!0),s.$directiveScope.$on("fa-pane-attach",function(e,t){t!==s&&(e.stopPropagation(),s.addChild(t))}),s.$directiveScope.$on("fa-pane-detach",function(e,t){t!==s&&(e.stopPropagation(),s.removeChild(t))}),t.addEventListener("resize",function(e){e.stopPropagation(),s.$scheduleReflow()}),s.$directiveScope.$on("$stateChangeSuccess",function(){s.$scheduleReflow()}),s.$directiveScope.$on("$viewContentLoaded",function(){s.$scheduleReflow()}),s.$directiveScope.$emit("fa-pane-attach",s),s.$directiveScope.$on("$destroy",function(){s.$directiveScope.$emit("fa-pane-detach",s)})})}}}}]),n.directive("faPaneToggle",["paneManager",function(e){return{link:function(e,t,n){n.$observe("faPaneToggle",function(e){})}}}]),n.directive("faPaneResizer",["$window",function(e){return{restrict:"A",link:function(n,o,a,r){r||(r=n.$pane);var s=o[0],l=5,h=300;n.$watch(function(){return r.getOrientation()},function(e){switch(e){case"vertical":o.removeClass("horizontal"),o.addClass("vertical");break;case"horizontal":o.addClass("horizontal"),o.removeClass("vertical")}}),s.addEventListener("mousedown",function(o){if(0===o.button){var a,c=r.anchor;"north"===c||"south"===c?a="screenY":("west"===c||"east"===c)&&(a="screenX");var u;"north"===c||"west"===c?u=1:("south"===c||"east"===c)&&(u=-1);var d={x:o.screenX,y:o.screenY},p=o[a],f=r.size,g=Date.now();s.unselectable="on",s.onselectstart=function(){return!1},s.style.userSelect=s.style.MozUserSelect=s.style.msUserSelect=s.style.webkitUserSelect="none",o.preventDefault(),o.defaultPrevented=!0,o=null;var $=function(e){i=!0,r.$onStartResize(),n.$apply(function(){var t=f+u*(e[a]-p);return r.resize(t)}),e.preventDefault(),e.defaultPrevented=!0,e=null},v=t.throttle($,16),w=function(t){var n=Math.pow(t.screenX-d.x,2)+Math.pow(t.screenY-d.y,2),o=Date.now()-g;e.removeEventListener("mousemove",v,!0),e.removeEventListener("mouseup",w,!0);var a=function(){r.$onStopResize(),t.preventDefault(),t.defaultPrevented=!0,t=null};n<=Math.pow(l,2)&&h>=o||$(t),a(),i=!1};e.addEventListener("mouseup",w,!0),e.addEventListener("mousemove",v,!0)}})}}}]),n});